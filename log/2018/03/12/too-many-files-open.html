<!DOCTYPE html>
<html>
  <head profile="http://www.w3.org/2005/10/profile">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Too Many Files Open</title>
  <meta name="description" content="Fitting lines to many spectra.">
  <link rel="stylesheet" href="/VIMOSlabbook/css/main.css">
  <link rel="stylesheet" href="/VIMOSlabbook/css/site.css"> 
  <link rel="stylesheet" href="/VIMOSlabbook/css/syntax.css"> 
  <link rel="stylesheet" href="/VIMOSlabbook/css/js9support.css"> 
  <link rel="stylesheet" href="/VIMOSlabbook/css/js9.css"> 
  <link rel="canonical" href="/VIMOSlabbook/log/2018/03/12/too-many-files-open.html">
  <link rel="alternate" type="application/rss+xml" title="Lab Notebook for VIMOS Data Reduction at TTU" href="/VIMOSlabbook/feed.xml">
  <!--<link rel="icon" type="image/png" href="/VIMOSlabbook/images/ico/favicon.png"> -->
  <link rel="icon" type="image/x-icon" href="/VIMOSlabbook/images/ico/favicon2.ico">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/VIMOSlabbook/">Lab Notebook for VIMOS Data Reduction at TTU</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/VIMOSlabbook/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/server.html">server</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/docker.html">docker</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/jupyter.html">jupyter</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/python.html">python</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/first.html">first</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/computer.html">computer</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/reproducible.html">reproducible</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/vimos.html">VIMOS</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/data.html">data</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/spectra.html">spectra</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/apall.html">apall</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/vimx.html">vimx</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/dbus.html">dbus</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/iraf.html">iraf</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/pyraf.html">pyraf</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/sexm.html">SEXM</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/srfm.html">SRFM</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/bokeh.html">bokeh</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/plot.html">plot</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/interactive.html">interactive</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx183.html">cx183</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx252.html">cx252</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/js9.html">js9</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx371.html">cx371</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/spectrum.html">spectrum</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/simbad.html">simbad</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/srei.html">SREI</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/glossary.html">glossary</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/definitions.html">definitions</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx65.html">cx65</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/vimos.html">vimos</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx.html">cx</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/information.html">information</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/cx59.html">CX59</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/classification.html">classification</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/sdss.html">sdss</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/template.html">template</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/pca.html">pca</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/paper.html">paper</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/classificatio.html">classificatio</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/astropy.html">astropy</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/fits.html">fits</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/segue.html">SEGUE</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/sdss.html">SDSS</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/line-index.html">line index</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/tag/ngc6652.html">ngc6652</a>
          
        
          
          <a class="page-link" href="/VIMOSlabbook/category/log/">log</a>
          
        
      </div>
    </nav>

  </div>
</header>



    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Too Many Files Open</h1>
    <p class="post-meta"><time datetime="2018-03-12T00:00:00-05:00" itemprop="datePublished">Mar 12, 2018</time></p>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript" src="/VIMOSlabbook/css/js9support.min.js"></script>
<script type="text/javascript" src="/VIMOSlabbook/css/js9.min.js"></script>
<script type="text/javascript" src="/VIMOSlabbook/css/js9plugins.js"></script>

  </header>


  <div class="post-content" itemprop="articleBody">
    <h1 id="fitting-lines-to-many-spectra.">Fitting lines to many spectra.</h1>
<p>Trying to fit the lines to a lot of spectra from SDSS I was getting the following error:</p>
<p><code>IOError: [Errno 24] Too many open files</code></p>
<p>About this issue the FAQ of Astropy says:</p>
<h3 id="im-opening-many-fits-files-in-a-loop-and-getting-oserror-too-many-open-files"><a href="http://docs.astropy.org/en/stable/io/fits/appendix/faq.html#i-m-opening-many-fits-files-in-a-loop-and-getting-oserror-too-many-open-files">I’m opening many FITS files in a loop and getting OSError: Too many open files</a></h3>
<blockquote>
<p>As explained in the note on <a href="http://docs.astropy.org/en/stable/io/fits/index.html#fits-large-files">working with large files</a>, because Astropy uses mmap by default to read the data in a FITS file, even if you correctly close a file with HDUList.close a handle is kept open to that file so that the memory-mapped data array can still be continued to be read transparently.</p>
</blockquote>
<p>I tried with gc.collect and deleting the variable that manps to the fit and it didn’t work. At the end I had to simply open the fit file with the opton <code>memmap=False</code>. I am not sure this was the optimal solution to the problem but it works.</p>
<p>In the documentation it says:</p>
<blockquote>
<p>In order to force the mmap to close either wait for the containing HDUList object to go out of scope, or manually call del hdul[0].data (this works so long as there are no other references held to the data array).</p>
</blockquote>
<p>So maybe I have to just try harder to do it this way instead of the easy solution of memmap=False.</p>

  </div>


<div class="well well-small">
<p class="text-info"><span class="glyphicons glyphicon-tag"></span>&nbsp;Tags</p>
<ul>

<li><a href='/VIMOSlabbook/tag/astropy.html'>astropy</a></li>

<li><a href='/VIMOSlabbook/tag/fits.html'>fits</a></li>

<li><a href='/VIMOSlabbook/tag/python.html'>python</a></li>

</ul>
</div>


</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Lab Notebook for VIMOS Data Reduction at TTU</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Lab Notebook for VIMOS Data Reduction at TTU</li>
          <li><a href="mailto:manuel.pichardo-marcano@ttu.edu">manuel.pichardo-marcano@ttu.edu</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This is my personal open lab notebook as part of a research project done at TTU starting in Fall 2016 under the supervision of Dr. Thomas Maccarone.
</p>
      </div>
    </div>

  </div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="/VIMOSlabbook/bootstrap-sass/assets/javascripts/bootstrap.js"></script>

</footer>


  </body>

</html>
